# Configuration système optimisée - Ponyo (AMD A6)
# À copier dans /etc/sysctl.d/99-ponyo.conf
# Puis: sudo sysctl --system

# ====================================
# Optimisations Mémoire
# ====================================

# Swappiness: adapter selon RAM
# - Si RAM ≤4GB: vm.swappiness=35
# - Si RAM 4-6GB: vm.swappiness=20  
# - Si RAM ≥8GB: vm.swappiness=10
vm.swappiness=20

# Pression cache vs swap
vm.vfs_cache_pressure=50

# Dirty ratio (données en cache avant écriture disque)
# HDD: valeurs plus basses (5/10)
# SSD: valeurs par défaut OK
vm.dirty_ratio=10
vm.dirty_background_ratio=5

# ====================================
# Optimisations Réseau
# ====================================

# Augmenter buffers TCP
net.core.rmem_max=16777216
net.core.wmem_max=16777216
net.ipv4.tcp_rmem=4096 87380 16777216
net.ipv4.tcp_wmem=4096 65536 16777216

# TCP Fast Open
net.ipv4.tcp_fastopen=3

# Réduire TIME_WAIT
net.ipv4.tcp_fin_timeout=30

# ====================================
# Optimisations Filesystem
# ====================================

# Augmenter nombre max fichiers ouverts
fs.file-max=2097152

# Inotify (pour IDEs et watchers)
fs.inotify.max_user_watches=524288
fs.inotify.max_user_instances=512

# ====================================
# Optimisations Sécurité
# ====================================

# Protection contre SYN flood
net.ipv4.tcp_syncookies=1
net.ipv4.tcp_syn_retries=2
net.ipv4.tcp_synack_retries=2

# Désactiver IPv6 (optionnel si non utilisé)
# net.ipv6.conf.all.disable_ipv6=1
# net.ipv6.conf.default.disable_ipv6=1

# ====================================
# Optimisations CPU/Scheduler
# ====================================

# Latence réduite pour desktop
kernel.sched_latency_ns=6000000
kernel.sched_min_granularity_ns=750000
kernel.sched_wakeup_granularity_ns=1000000

# ====================================
# Notes
# ====================================

# Installation:
# sudo cp config/sysctl-ponyo.conf /etc/sysctl.d/99-ponyo.conf
# sudo sysctl --system
#
# Vérification:
# sysctl vm.swappiness
# sysctl -a | grep -i dirty
